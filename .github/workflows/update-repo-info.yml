###############################################################################
# UPDATE REPO INFO
###############################################################################

name: Update repo info

###############################################################################
# ON
###############################################################################

on:
  push:
    branches:
      - main
    paths:
      - 'package.json'
  workflow_dispatch:

###############################################################################
# JOBS
###############################################################################

jobs:
  build:
    name: Update repo info
    runs-on: ubuntu-latest

    ###########################################################################
    # STEPS
    ###########################################################################

    steps:

      #########################################################################
      # INIT REPO
      #########################################################################

      - name: ðŸ›Ž Checkout
        uses: actions/checkout@v3

      #########################################################################
      # GET DATA
      #########################################################################

      - name: Get PACKAGE data
        id: pkg
        run: |
          content=$(jq -r . ./package.json)
          echo "::set-output name=packageJson::$content"

      #########################################################################
      # UPDATE
      #########################################################################

      - name: Change GitHub data
        run: |
          repo_url=$(echo "${{ steps.pkg.outputs.packageJson }}" | jq -r '.repository.url')
          description=$(echo "${{ steps.pkg.outputs.packageJson }}" | jq -r '.description')
          homepage=$(echo "${{ steps.pkg.outputs.packageJson }}" | jq -r '.homepage')
          keywords=$(echo "${{ steps.pkg.outputs.packageJson }}" | jq -r '.keywords | join(",")')

          if [[ -n $repo_url ]]; then
            gh repo edit "$repo_url" -d "$description"
          fi

          if [[ -n $keywords ]]; then
            gh repo edit "$repo_url" --add-topic "$keywords"
          fi

          if [[ -n $homepage ]]; then
            gh repo edit "$repo_url" --homepage "$homepage"
          fi
        env:
            GH_TOKEN: ${{ secrets.GH_TOKEN }}

###############################################################################
