###############################################################################
# UPDATE REPO INFO
###############################################################################

name: Update repo info

###############################################################################
# ON
###############################################################################

on:
  push:
    branches:
      - main
    paths:
      - 'package.json'
  workflow_dispatch:

###############################################################################
# JOBS
###############################################################################

jobs:
  build:
    name: Update repo info
    runs-on: ubuntu-latest

    ###########################################################################
    # STEPS
    ###########################################################################

    steps:

      #########################################################################
      # INIT REPO
      #########################################################################

      - name: ðŸ›Ž Checkout
        uses: actions/checkout@v3


      #########################################################################
      # GET DATA
      #########################################################################

      - name: Get PACKAGE data
        id: pkg
        run: |
          content=`cat ./package.json`
          content="${content//'%'/'%25'}"
          content="${content//$'\n'/'%0A'}"
          content="${content//$'\r'/'%0D'}"
          echo "packageJson=$content" >> $GITHUB_OUTPUT
          echo $GITHUB_OUTPUT

      #########################################################################
      # UPDATE
      #########################################################################

      - name: Change GitHub data
        run: |
          gh repo edit ${{fromJson(steps.pkg.outputs.packageJson).repository.url}} -d "${{fromJson(steps.pkg.outputs.packageJson).description}}"
          gh repo edit ${{fromJson(steps.pkg.outputs.packageJson).repository.url}} --add-topic ${{fromJson(steps.pkg.outputs.packageJson).keywords}}
          gh repo edit ${{fromJson(steps.pkg.outputs.packageJson).repository.url}} --homepage ${{fromJson(steps.pkg.outputs.packageJson).homepage}}
        env:
            GH_TOKEN: ${{ github.token }}
###############################################################################
